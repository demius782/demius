# 音乐播放器功能指南

本指南详细介绍如何在 Demius 主题中使用音乐播放器功能。

---

## 📋 目录

- [功能特性](#功能特性)
- [快速开始](#快速开始)
- [支持的音乐源](#支持的音乐源)
- [基础用法](#基础用法)
- [高级配置](#高级配置)
- [参数说明](#参数说明)
- [播放器功能](#播放器功能)
- [响应式设计](#响应式设计)
- [暗色模式](#暗色模式)
- [PJAX兼容性](#pjax兼容性)
- [常见问题](#常见问题)
- [最佳实践](#最佳实践)

---

## ✨ 功能特性

- ✅ **多平台支持**：网易云音乐、QQ音乐
- ✅ **多种音源**：云音乐、本地文件、在线链接
- ✅ **歌单支持**：支持导入完整歌单
- ✅ **混合播放**：多种类型混合播放列表
- ✅ **播放控制**：播放/暂停、上一首/下一首、进度调节
- ✅ **循环模式**：列表循环、单曲循环、顺序播放
- ✅ **播放顺序**：顺序播放、随机播放
- ✅ **音量控制**：音量调节、静音切换
- ✅ **播放列表**：可视化播放列表管理
- ✅ **主题定制**：自定义主题颜色
- ✅ **迷你模式**：适合小空间显示
- ✅ **响应式**：完美适配所有设备
- ✅ **暗色模式**：自动适配主题切换
- ✅ **PJAX兼容**：无刷新导航支持

---

## 🚀 快速开始

### 1. 基础使用

在文章中插入音乐播放器：

```markdown
{{< music "netease:1901371647" >}}
```

### 2. 查看效果

保存文章，访问页面即可看到播放器。

### 3. 开始播放

点击播放按钮开始欣赏音乐！

---

## 🎵 支持的音乐源

### 1. 网易云音乐

**单曲**：
```markdown
{{< music "netease:歌曲ID" >}}
```

**歌单**：
```markdown
{{< music "netease-playlist:歌单ID" >}}
```

**获取ID方法**：
- 打开网易云音乐网页版
- 播放歌曲或打开歌单
- 地址栏：`https://music.163.com/#/song?id=1901371647`
- `id=` 后面的数字就是ID

---

### 2. QQ音乐

**单曲**：
```markdown
{{< music "qq:歌曲ID" >}}
```

**歌单**：
```markdown
{{< music "qq-playlist:歌单ID" >}}
```

**获取ID方法**：
- 打开QQ音乐网页版
- 播放歌曲或打开歌单
- 地址栏：`https://y.qq.com/n/ryqq/songDetail/002zjw1O2FxgOr`
- 最后一段就是ID

---

### 3. 酷狗音乐

**单曲**：
```markdown
{{< music "kugou:歌曲Hash" >}}
```

**歌单**：
```markdown
{{< music "kugou-playlist:歌单ID" >}}
```

**获取Hash/ID方法**：
- 打开酷狗音乐网页版
- 播放歌曲或打开歌单
- 地址栏查看对应的Hash或ID
- 示例：`https://www.kugou.com/song/#hash=D6AB302BS6519B3D666E4F6C8CDAFE6B`

---

### 4. 本地音乐

```markdown
{{< music "local:/audio/song.mp3" >}}
```

**文件放置**：
- 将音频文件放在 `static/audio` 目录下
- 路径会自动去除 `static` 前缀
- 示例：
  - 文件位置：`static/audio/song.mp3`
  - 使用方式：`local:/audio/song.mp3` 或 `local:audio/song.mp3`

**支持格式**：MP3、WAV、OGG、AAC、M4A、FLAC等

**注意事项**：
- 确保文件已上传到服务器的 `static/audio` 目录
- 本地开发时，文件需要在 Hugo 项目的 `static/audio` 目录中
- 路径以 `/` 开头或不开头都可以，插件会自动处理

---

### 5. 在线链接

```markdown
{{< music "url:https://example.com/audio.mp3" >}}
```

**重要说明**：
- ✅ **必须是直接的音频文件链接**（如 .mp3, .wav, .ogg）
- ❌ **不支持音乐网站的歌曲页面链接**（如网易云、QQ音乐、酷狗的网页链接）
- ✅ 确保链接可公开访问，不需要认证
- ✅ 建议使用HTTPS链接
- ⚠️ 注意跨域访问限制（CORS），某些服务器可能不允许跨域播放

**正确示例**：
- ✅ `url:https://cdn.example.com/music/song.mp3`
- ✅ `url:https://your-oss.com/audio/demo.ogg`

**错误示例**：
- ❌ `url:https://music.163.com/#/song?id=123456`（这是网页链接，不是音频文件）
- ❌ `url:https://y.qq.com/n/ryqq/songDetail/xxxxx`（这是网页链接）
- ❌ `url:https://www.kugou.com/song/#hash=xxxxx`（这是网页链接）

---

## 📖 基础用法

### 单个音乐源

```markdown
<!-- 网易云单曲 -->
{{< music "netease:1901371647" >}}

<!-- QQ音乐单曲 -->
{{< music "qq:002zjw1O2FxgOr" >}}

<!-- 酷狗音乐单曲 -->
{{< music "kugou:D6AB302BS6519B3D666E4F6C8CDAFE6B" >}}

<!-- 本地文件 -->
{{< music "local:/music/song.mp3" >}}

<!-- 在线链接 -->
{{< music "url:https://example.com/audio.mp3" >}}
```

---

### 多个音乐源

创建播放列表，支持多种类型混合：

```markdown
{{< music "netease:1901371647" "qq:002zjw1O2FxgOr" "kugou:D6AB302BS6519B3D666E4F6C8CDAFE6B" "local:/music/song.mp3" >}}
```

---

### 歌单播放

```markdown
<!-- 网易云歌单 -->
{{< music "netease-playlist:2884035" >}}

<!-- QQ音乐歌单 -->
{{< music "qq-playlist:7896171690" >}}

<!-- 酷狗音乐歌单 -->
{{< music "kugou-playlist:123456" >}}
```

---

## ⚙️ 高级配置

### 自动播放

```markdown
{{< music "netease:1901371647" autoplay="true" >}}
```

**说明**：
- 默认值：`false`
- 建议：不建议开启，影响用户体验
- 注意：某些浏览器可能阻止自动播放

---

### 自定义主题色

```markdown
{{< music "netease:1901371647" theme="#ff6b6b" >}}
```

**说明**：
- 默认值：`#0066cc`
- 格式：十六进制颜色代码
- 影响：进度条、高亮等元素颜色

**示例颜色**：
- 红色：`#ff6b6b`
- 粉色：`#e91e63`
- 紫色：`#8e44ad`
- 蓝色：`#0066cc`
- 绿色：`#52c41a`
- 橙色：`#fa8c16`

---

### 循环模式

```markdown
{{< music "netease:1901371647" loop="one" >}}
```

**可选值**：
- `all`：列表循环（默认）
- `one`：单曲循环
- `none`：顺序播放，播放完停止

---

### 播放顺序

```markdown
{{< music "netease-playlist:2884035" order="random" >}}
```

**可选值**：
- `list`：顺序播放（默认）
- `random`：随机播放

---

### 默认音量

```markdown
{{< music "netease:1901371647" volume="0.5" >}}
```

**说明**：
- 默认值：`0.7`
- 范围：`0` - `1`
- `0`：静音
- `1`：最大音量

---

### 列表最大高度

```markdown
{{< music "netease-playlist:2884035" listMaxHeight="400px" >}}
```

**说明**：
- 默认值：`250px`
- 格式：CSS长度值（px、rem、vh等）
- 超出高度自动滚动

---

### 迷你模式

```markdown
{{< music "netease:1901371647" mini="true" >}}
```

**说明**：
- 默认值：`false`
- 适用场景：侧边栏、小空间显示
- 特点：紧凑布局、较小尺寸

---

### 完整配置示例

```markdown
{{< music 
  "netease:1901371647" 
  "netease:1868553" 
  "netease:1868896"
  autoplay="false"
  theme="#0066cc"
  loop="all"
  order="list"
  volume="0.7"
  listMaxHeight="300px"
  mini="false"
>}}
```

---

## 📊 参数说明

### 位置参数（音乐源）

| 格式 | 说明 | 示例 |
|------|------|------|
| `netease:ID` | 网易云单曲 | `netease:1901371647` |
| `netease-playlist:ID` | 网易云歌单 | `netease-playlist:2884035` |
| `qq:ID` | QQ音乐单曲 | `qq:002zjw1O2FxgOr` |
| `qq-playlist:ID` | QQ音乐歌单 | `qq-playlist:7896171690` |
| `local:路径` | 本地文件 | `local:/music/song.mp3` |
| `url:链接` | 在线链接 | `url:https://example.com/audio.mp3` |

---

### 命名参数（配置选项）

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| autoplay | boolean | false | 是否自动播放 |
| theme | string | #0066cc | 主题颜色 |
| loop | string | all | 循环模式：all/one/none |
| order | string | list | 播放顺序：list/random |
| volume | number | 0.7 | 默认音量：0-1 |
| listMaxHeight | string | 250px | 列表最大高度 |
| mini | boolean | false | 迷你模式 |

---

## 🎮 播放器功能

### 基础控制

**播放/暂停** ▶️⏸️
- 点击中央大按钮
- 控制当前歌曲播放状态

**上一首** ⏮️
- 播放列表中的上一首歌曲
- 第一首时跳转到最后一首

**下一首** ⏭️
- 播放列表中的下一首歌曲
- 最后一首时跳转到第一首（循环模式）

---

### 高级控制

**循环模式** 🔁
- 列表循环：播放完列表重新开始
- 单曲循环：重复播放当前歌曲
- 顺序播放：播放完停止

**播放顺序** 🔀
- 顺序播放：按列表顺序播放
- 随机播放：随机选择下一首

**播放列表** 📋
- 查看完整播放列表
- 点击任意歌曲切换播放
- 当前播放项高亮显示

---

### 进度控制

**进度条** 🎚️
- 显示播放进度
- 显示缓冲进度
- 点击跳转到指定位置

**时间显示** ⏱️
- 左侧：当前播放时间
- 右侧：歌曲总时长

---

### 音量控制

**音量滑块** 🔊
- 点击调节音量
- 范围：0% - 100%

**音量按钮** 🔇
- 点击静音/取消静音
- 快速控制音量

---

## 📱 响应式设计

### 桌面端 (> 1024px)

**布局**：
- 横向布局
- 封面在左侧
- 信息和控制在右侧

**尺寸**：
- 封面：120x120px
- 完整控制按钮
- 完整播放列表

**体验**：
- 悬停效果
- 平滑动画
- 完整功能

---

### 平板端 (768px - 1023px)

**布局**：
- 保持横向布局
- 自适应宽度

**调整**：
- 封面适度缩小
- 按钮间距优化
- 列表高度自适应

---

### 移动端 (< 768px)

**布局**：
- 纵向布局
- 封面在上方
- 信息和控制在下方

**尺寸**：
- 封面：160x160px - 200x200px
- 较大的触摸区域
- 简化的控制面板

**优化**：
- 居中对齐
- 触摸友好
- 性能优化

---

## 🌙 暗色模式

播放器自动适配暗色模式，无需额外配置。

### 自动适配内容

- ✅ 背景颜色
- ✅ 文字颜色
- ✅ 边框颜色
- ✅ 阴影效果
- ✅ 进度条颜色
- ✅ 按钮悬停效果
- ✅ 列表背景

### 切换方式

- 跟随系统主题设置
- 跟随网站主题切换
- 实时自动更新

---

## 🔄 PJAX兼容性

播放器完全兼容PJAX无刷新导航。

### 自动处理

- ✅ 页面切换时自动清理
- ✅ 新页面自动初始化
- ✅ 播放状态不冲突
- ✅ 内存正确释放

### 用户体验

- 切换页面时停止播放
- 新页面独立播放器实例
- 不影响导航流畅度

---

## 🔍 常见问题

### Q1: 播放器无法加载？

**可能原因**：
1. 歌曲ID错误
2. 网络连接问题
3. API服务不可用

**解决方法**：
1. 检查歌曲ID是否正确
2. 检查网络连接
3. 刷新页面重试
4. 尝试其他歌曲

---

### Q2: 无法播放音乐？

**可能原因**：
1. 音频链接失效
2. 版权限制
3. 浏览器不支持格式

**解决方法**：
1. 检查音频链接有效性
2. 尝试其他歌曲
3. 更换浏览器
4. 检查浏览器控制台错误

---

### Q3: 网易云/QQ音乐解析失败？

**可能原因**：
1. 歌曲ID格式错误
2. 歌曲已下架
3. 地区限制
4. API限流

**解决方法**：
1. 确认ID格式正确
2. 尝试其他歌曲
3. 稍后再试

---

### Q4: 本地音乐无法播放？

**检查项**：
1. 文件是否在 `static` 目录
2. 路径是否正确
3. 文件格式是否支持
4. 文件是否损坏

**正确路径**：
- 文件位置：`static/music/song.mp3`
- Shortcode：`local:/music/song.mp3`

---

### Q5: 播放列表不显示？

**可能原因**：
1. 只有一首歌曲
2. 列表默认隐藏

**解决方法**：
1. 添加多首歌曲
2. 点击列表按钮 📋

---

### Q6: 移动端显示异常？

**解决方法**：
1. 刷新页面
2. 清除浏览器缓存
3. 使用迷你模式

---

### Q7: 自动播放不工作？

**说明**：
- 现代浏览器通常阻止自动播放
- 需要用户交互后才能播放
- 这是浏览器安全策略

**建议**：
- 不建议使用自动播放
- 让用户主动点击播放

---

### Q8: 如何获取歌曲ID？

**网易云音乐**：
```
URL: https://music.163.com/#/song?id=1901371647
ID: 1901371647
```

**QQ音乐**：
```
URL: https://y.qq.com/n/ryqq/songDetail/002zjw1O2FxgOr
ID: 002zjw1O2FxgOr
```

**歌单ID获取类似**

---

### Q9: 播放器卡顿？

**可能原因**：
1. 网络速度慢
2. 歌曲数量太多
3. 设备性能不足

**优化方法**：
1. 减少歌曲数量
2. 使用迷你模式
3. 避免多个播放器

---

### Q10: 版权问题？

**注意事项**：
- ⚠️ 网易云/QQ音乐：遵守平台版权规定
- ⚠️ 本地/在线音频：确保有使用权
- ⚠️ 商业网站：特别注意版权问题
- ⚠️ 建议：注明音乐来源

---

## 🎯 最佳实践

### 1. 用户体验

**推荐做法**：
- ✅ 不要默认自动播放
- ✅ 设置合适的默认音量
- ✅ 提供清晰的播放列表
- ✅ 在文章开头说明有音乐
- ✅ 音乐与内容相关

**避免做法**：
- ❌ 强制自动播放
- ❌ 音量过大
- ❌ 播放器过多
- ❌ 无关音乐

---

### 2. 性能优化

**建议**：
- ✅ 单页播放器数量 ≤ 3个
- ✅ 歌单歌曲数量 ≤ 30首
- ✅ 使用迷你模式节省空间
- ✅ 按需加载，不预加载
- ✅ 避免大文件

---

### 3. 内容策略

**适用场景**：
- ✅ 音乐分享文章
- ✅ 歌单推荐
- ✅ 音乐教程
- ✅ 背景音乐
- ✅ 播客节目

**注意事项**：
- ✅ 音乐与主题相关
- ✅ 注明来源和版权
- ✅ 提供歌曲信息
- ✅ 考虑读者偏好

---

### 4. 文件管理

**本地音乐**：
```
static/
  └── music/
      ├── bgm/          # 背景音乐
      │   ├── song1.mp3
      │   └── song2.mp3
      ├── podcast/      # 播客
      │   ├── ep1.mp3
      │   └── ep2.mp3
      └── demo/         # 演示音频
          └── sample.mp3
```

**命名规范**：
- 使用英文或拼音
- 避免特殊字符
- 文件名有意义
- 统一格式（MP3推荐）

---

### 5. 版权合规

**基本原则**：
- ✅ 确认有使用权
- ✅ 注明来源
- ✅ 遵守平台规定
- ✅ 商业用途特别注意

**推荐做法**：
- 使用免版权音乐
- 购买版权授权
- 使用Creative Commons音乐
- 注明许可协议

---

## 💡 使用技巧

### 1. 创建主题歌单

```markdown
<!-- 轻音乐系列 -->
{{< music 
  "netease:29722582" 
  "netease:29750099" 
  "netease:29722591"
  theme="#52c41a"
  loop="all"
>}}
```

---

### 2. 背景音乐

```markdown
<!-- 页面背景音乐，使用迷你模式 -->
{{< music "netease:1868896" mini="true" volume="0.3" >}}
```

---

### 3. 音乐推荐列表

```markdown
<!-- 本周推荐 -->
{{< music "netease-playlist:2884035" theme="#e91e63" >}}
```

---

### 4. 播客节目

```markdown
<!-- 播客节目，使用本地文件 -->
{{< music 
  "local:/podcast/episode-1.mp3"
  "local:/podcast/episode-2.mp3"
  theme="#8e44ad"
>}}
```

---

### 5. 混合播放列表

```markdown
<!-- 混合云音乐和本地音乐 -->
{{< music 
  "netease:1901371647"
  "qq:002zjw1O2FxgOr"
  "local:/music/favorite.mp3"
  order="random"
>}}
```

---

## 📚 更多资源

### 免版权音乐网站

- [Free Music Archive](https://freemusicarchive.org/)
- [Incompetech](https://incompetech.com/music/)
- [YouTube Audio Library](https://www.youtube.com/audiolibrary)
- [Bensound](https://www.bensound.com/)
- [CC Mixter](http://ccmixter.org/)

---

### 音频格式转换工具

- [FFmpeg](https://ffmpeg.org/) - 命令行工具
- [Audacity](https://www.audacityteam.org/) - 音频编辑
- [Online Audio Converter](https://online-audio-converter.com/) - 在线转换

---

### 相关文档

- [音乐播放器使用示例](../content/posts/音乐播放器功能使用示例.md)
- [Demius主题文档](README.md)
- [其他功能指南](.)

---

## ⚠️ 重要说明

### API配置化管理（v1.4.0+）

从 v1.4.0 版本开始，音乐播放器的API端点可以在 `hugo.toml` 配置文件中自定义管理。

**如何使用：**
1. 在 `hugo.toml` 中配置API端点
2. 可以添加多个备用API
3. 可以启用/禁用特定API
4. 支持自建API服务

**详细配置方法请查看：[音乐API配置指南](music-api-config-guide.md)**

---

### 第三方API当前状态

由于版权和政策原因，大部分公开的第三方音乐解析API已失效。

**当前可用功能：**
- ✅ 本地音乐文件播放（完全支持）
- ✅ 直接音频URL播放（需要支持CORS的链接）
- ⚠️ 网易云音乐（需要自行配置可用API）
- ⚠️ QQ音乐（需要自行配置可用API）
- ⚠️ 酷狗音乐（需要自行配置可用API）

**解决方案：**
1. 使用本地音乐文件（推荐）
2. 使用支持CORS的CDN托管
3. 自建音乐API服务
4. 配置新的可用API端点

---

## 🔧 故障排查

### 问题1：QQ音乐/酷狗音乐无法播放

**可能原因**：
- API限制或歌曲ID/Hash不正确
- 第三方API服务不稳定
- 歌曲版权限制

**解决方法**：
1. 检查浏览器控制台的错误日志
2. 确认歌曲ID/Hash是否正确（从对应音乐平台网页版URL获取）
3. 尝试更换其他歌曲ID测试
4. 考虑使用网易云音乐作为替代（相对更稳定）

---

### 问题2：本地音乐无法播放

**可能原因**：
- 文件路径错误
- 文件不存在
- 音频格式不支持

**解决方法**：
1. 确认文件已放置在 `static/audio` 目录
2. 检查文件路径是否正确（区分大小写）
3. 确认音频格式是否为 MP3/WAV/OGG 等常见格式
4. 打开浏览器控制台查看详细错误信息
5. 尝试直接访问音频URL（如 `http://localhost:1313/audio/song.mp3`）

---

### 问题3：在线链接无法播放

**可能原因**：
- URL不是直接的音频文件链接
- 跨域访问被阻止（CORS）
- 链接需要认证
- 链接已失效

**解决方法**：
1. 确认URL是直接的音频文件链接（.mp3, .wav等）
2. 检查浏览器控制台是否有CORS错误
3. 尝试在浏览器中直接打开该URL，看是否能播放
4. 使用支持CORS的音频托管服务
5. 考虑将音频文件下载后作为本地文件使用

---

### 问题4：所有音乐平台都无法播放

**说明**：
v1.2.0版本已添加多个备用API，会自动切换。如果仍然无法播放：

**可能原因**：
- 所有第三方API都暂时失效
- 网络连接问题
- API被墙或限制访问

**解决方法**：
1. 查看浏览器控制台，检查是否看到 "尝试使用API [xxx]" 的日志
2. 查看是否有 "切换到API [xxx]" 的提示
3. 如果看到 "所有API都失败了"，说明当前所有备用API都不可用
4. 等待一段时间后重试（API可能临时维护）
5. 使用本地文件播放作为备选方案

**建议**：
- 优先使用网易云音乐（相对更稳定）
- 本地文件和URL类型需确保路径/链接正确
- 查看浏览器控制台的详细日志信息
- 播放器会自动尝试多个API，无需手动切换

---

### 调试技巧

1. **开启浏览器控制台**：
   - Chrome/Edge: 按 `F12` 或 `Ctrl+Shift+I`
   - 切换到 Console 标签

2. **查看详细日志**：
   - 播放器会输出详细的调试信息
   - 查找以"网易云音乐API返回"、"QQ音乐API返回"、"酷狗音乐API返回"开头的日志
   - 查看是否有"音频加载失败"的错误信息

3. **常见错误代码**：
   - `MEDIA_ERR_ABORTED (1)`: 播放被中止
   - `MEDIA_ERR_NETWORK (2)`: 网络错误
   - `MEDIA_ERR_DECODE (3)`: 解码错误
   - `MEDIA_ERR_SRC_NOT_SUPPORTED (4)`: 不支持的音频格式或来源

---

## 🔄 更新日志

### v1.4.0 (2025-10-25)
- 🎉 **重大更新：支持API配置化管理**
- ✅ 在 `hugo.toml` 中自定义API端点
- ✅ 支持多个API自动切换
- ✅ 支持启用/禁用特定API
- ✅ 支持自建API服务
- 📝 新增 [音乐API配置指南](music-api-config-guide.md)
- 💡 无需修改代码即可更换API

### v1.3.0 (2025-10-25)
- ⚠️ **重要通知：第三方音乐API已全部失效**
- ❌ 网易云音乐、QQ音乐、酷狗音乐API不再可用
- ✅ 保留本地文件播放功能（完全正常）
- ✅ 保留URL直链播放功能
- 📝 更新文档说明当前状态
- 💡 建议用户使用本地文件或自建音乐服务

### v1.2.1 (2025-10-25)
- 🔧 **紧急修复：更换更可靠的API端点**
- ✅ 新增uapis API (api.uapis.cn) - 主要API
- ✅ 新增oioweb API (api.oioweb.cn) - 备用API
- 🐛 修复API响应格式兼容性问题
- 📝 改进日志输出，使用 ✓ 和 ✗ 标记

### v1.2.0 (2025-10-25)
- 🔧 **重大改进：添加多个备用API支持**
- ✅ 自动在多个API端点之间切换，提高稳定性
- ✅ 实现自动重试机制
- 🐛 修复API失效导致无法播放的问题
- 📝 增强错误日志，显示API切换过程

### v1.1.0 (2025-10-25)
- ✨ **新增酷狗音乐支持**
- ✅ 支持酷狗音乐单曲 (`kugou:歌曲Hash`)
- ✅ 支持酷狗音乐歌单 (`kugou-playlist:歌单ID`)
- 📝 更新所有文档和示例
- 🔧 完善故障排查说明

### v1.0.1 (2025-10-25)
- 🐛 修复本地文件路径处理逻辑
- 🐛 优化URL类型音乐的解析（现在只支持直接音频文件链接）
- 🔧 增强API错误处理和日志输出
- 📝 完善文档说明，添加故障排查章节
- 🎨 改进音频加载错误的提示信息

### v1.0.0 (2025-10-25)
- ✨ 首次发布音乐播放器功能
- ✅ 支持网易云音乐和QQ音乐
- ✅ 支持本地文件和在线链接
- ✅ 支持歌单和混合播放
- ✅ 完整的播放器控制功能
- ✅ 响应式设计和暗色模式
- ✅ PJAX兼容性

---

**祝你使用愉快！享受音乐！** 🎵🎶


